## Домашнее задание по Hadoop

В данном ДЗ нужно решить 2 задачи. Решение надо выполнить на Java с помощью Hadoop Java API (http://hadoop.apache.org/docs/r2.6.1/api/) или на Hadoop Streaming. При решении задач старайтесь использовать оптимальный MapReduce-алгоритм:
 - использовать как можно меньшее кол-во Hadoop Job,
 - использовать больше, чем 1 reducer (1 reducer разрешается использовать только в финальной job'е, при сортировке результата)

1. [1 балл]. Задачу 110 решают все.
2. [2 балла]. 2-я задача определяется из оставшихся по логину в GitLab. Для определения номера выполните [этот код](/variant_counters/get_mr_variant.py), в кач-ве аргумента подайте свой **логин в GitLab.atp-fivt.org**.

Пример рассчёта номера:

```
$ ./get_mr_variant.py velkerr
116
```

Закоммитить код в соответствующий репозиторий на gitlab.atp-fivt.org. Задачу 110 залить в ветку mapreducetask1, а 2-ю задачу - в mapreducetask2.

<p>
<details>
<summary markdown="span"><h3> Сроки сдачи </h3></summary>

| Группа | Soft deadline | Hard deadline |
| ---      |  ------  |------|
|Б05-812|21.11, 23:59|28.11, 23:59|
|Б05-824 и Б05-825|21.11, 23:59|28.11, 23:59|
|Б05-822|15.11, 23:59|22.11, 23:59|
|Б05-811|16.11, 23:59|23.11, 23:59|
|Б05-821 и Б05-831|16.11, 23:59|23.11, 23:59|
|Б05-813|17.11, 23:59|24.11, 23:59|
|Б05-823|17.11, 23:59|24.11, 23:59|
|Б05-826|17.11, 23:59|24.11, 23:59|

Исправления можно делать в течение месяца после комментариев.

* Штраф за опоздание по soft deadline: 50%
* Штраф за опоздани по hard deadline: 75%

</details>
</p>

### Подготовка кода для сдачи
Для каждой домашки имеются предваритиельно созданные репозитории с веткой master и ветками для каждой задачи в домашке. Для сдачи домашки нужно:
1. В каждой ветке в корень положить файл `.gitlab-ci.yml` такого содержания:
```yml
job1:
  except:
    - master
  script:
    - date
    - if [ `grep -v '#' ${CI_COMMIT_REF_NAME}/run.sh | wc -l` -gt 0 ]; then (cd ~/code; ./gitlab_ci_runner.py); else exit 1; fi
```
(можно взять [отсюда](http://gitlab.atp-fivt.org/root/demos/blob/ci_files/.gitlab-ci.yml))

2. В каждой ветке создать директорию, имя директории = имени ветки. Например, нужно создать директории с названиями `mapreducetask1` и `mapreducetask2` в ветках `mapreducetask1` и `mapreducetask2` соотвественно.

3. В созданных директориях положите файл `run.sh`. Это точка входа в вашу программу и именно её будет запускать система проверки. В `run.sh` может быть как всё решение задачи так и вызов других файлов.

> Даже если разрабатываете на Python, `run.sh` может содержать только вызов нужного скрипта, например: 
> 
> 	#!/usr/bin/env bash
> 	
> 	python my_python_script.py $*
>
> Тут $* обеспечит передачу параметров, с которыми был вызван `run.sh` в `my_python_script.py`.

### Входные данные

Википедия:
* Путь на кластере: `/data/wiki/en_articles`, семпл: `/data/wiki/en_articles_part`
* Формат: текст, в каждой строке:
          `идентификатор статьи <tab> текст статьи`

Список идентификаторов:
* Путь на кластере: полный датасет - `/data/ids`, семпл - `/data/ids_part`
* Формат: текст, один идентификатор в строке
 
### Задачи
 
1.(110) Список идентификаторов перемешайте в случайном порядке. Далее в каждой строке запишите через запятую случайное число идентификаторов - от 1 до 5.
Вариант способа перемешивания записей: дописать к каждой случайное число, отсортировать по нему весь список, потом число отбросить.
* Входные данные: список идентификаторов.
* Формат вывода: id1,id2,...
* Вывод на печать: первые 50 строк.

P.S. Задача из реальной жизни. Нужно было проверить сервер новой БД на нагрузку (“обстрелять”). Для этого нужно было сгенерировать запросы к ней (т.н.”патроны”), которые бы походили на реальные. Был известен список ключей, которые в этой базе могут быть, также было известно, что в одном запросе таких ключей до пяти штук.

Пример вывода:
```
1cf54b530128257d72,4cdf3efa01036a9a48,8c3e7fb30261aaf9cf
4cfe6230016553c3ed,76e1b8690176f801bb,e7409c39013c9db7b4,a5f1519c02b22550e6
83a119ef02346d0879
```
 
2.(111) Посчитайте число вхождений имён собственных длиной от 6 до 9 символов. Имя собственное - это слово, начинающееся с заглавной буквы и последующих маленьких букв (и только маленьких) и которое ни разу не встретилось в тексте с маленькой буквы.
При разборе статей очищайте слова от от знаков пунктуации. Результат приведите к нижнему регистру и отсортируйте по убыванию числа вхождений, в случае равенства - лексикографически.
* Входные данные: википедия.
* Формат вывода в HDFS: имя <tab> количество
* Вывод на печать: топ10 имен.

Пример вывода:
```
english 8358
states  7264
british 6829
```

3.(112) (“Стоп-слова”) Найдите слова, которые встречались в наибольшем числе документов.
Очистите слова от знаков пунктуации. Отсортируйте слова по числу документов, при равном числе - лексикографически.
* Входные данные: википедия.
* Формат вывода: слово <tab> число документов.
* Вывод на печать: топ10 слов

Пример вывода:
```
and	4053
in	4048
to	4045
```

4.(113) Слова считаем равными с точностью до перестановки букв (abc=bca). Найдите наиболее популярные перестановки, также посчитайте число исходных слов для перестановки. Т.е. если ‘abc’ встретилось 50 раз и ‘bca’ 50 и других слов из этих букв не было, то в результате будет: abc 100 2.
Отсортируйте результат по убыванию популярности перестановки (по 2-му полю), с одинаковой популярностью – лексикографически. Исходные данные очищайте от знаков пунктуации и приводите к нижнему регистру. Фильтруйте слова короче 3х символов.
* Входные данные: википедия.
* Формат вывода: перестановка <tab> сколько раз встретилась <tab> число исходных слов (уникальных)
* Вывод на печать: топ10 перестановок

Пример вывода:
```
for     91296   6
ahtt    81580   2
hitw    79582   2
```
 
5.(114) То же, что задача 4, только считаем также, сколько раз встретилось исходное слово. На выходе выписываем перестановку, ее популярность и первые 5 самых популярных исходных слов, для примера из задачи 2: abc 100 abc:50;bca:50
Сортировка та же, что в задаче 2. Исходные данные очищайте от знаков пунктуации, фильтруйте слова короче 3х символов.
* Входные данные: википедия.
* Формат вывода: перестановка <tab> сколько раз встретилась <tab> слово1:популярность1;…
* Вывод на печать: топ10 перестановок

Пример вывода:
```
asw	91833	was:90214;saw:1604;asw:11;aws:2;wsa:1;
for	89924	for:89912;fro:6;rof:4;rfo:1;ofr:1;
ahtt	81085	that:81085;
```

6.(116) (“Биграммы”) Найдите пары слов (биграмм), которые встречались в наибольшем числе документов. При разборе статей очищайте слова от от знаков пунктуации. Отсортируйте слова по числу документов, при равном числе - лексикографически.
* Входные данные: википедия.
* Формат вывода: слово#1 слово#2 <tab> число документов.
* Вывод на печать: топ10 биграмм

Пример вывода:
```
and the	3495
on the	3326
by the	3250
```

### Подсказки к решению задач
1. Во всех задачах на обработку википедии (111-116) перед вычислениями надо привести слова к нижнему регистру.
2. Для фильтрации мусора используем регулярку `[^A-Za-z\\s]`
3. Пробелами считаем стандартные пробельные символы `[ \t\n\r\f\v]` или их последовательность (см. документацию по ф-ции `string.split()` в Python).
4. Система тестирования читает ответ из STDOUT поэтому при выводе из STDOUT требуется вычистить всё, что не является ответом задачи. STDERR наоборт нужно оставить нетронутым.

