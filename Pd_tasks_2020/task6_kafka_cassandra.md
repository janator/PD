# Домашнее задание по Kafka и Cassandra

* Deadline (для всех общий): 9.01, 23:59
После deadline задания не принимаются.

Код задач заливать аналогично предыдущим домашкам, в репозиторий `pdfinal`. Тестов на эту домашку нет поэтому не обращайте внимание на падения CI-чекера.

## Раздел Kafka

### Задание 1 [0,2 балла]. 
Используя Kafka CLI или Kafka Python API, посчитать кол-во сообщений в топике. Программа должна принимать на вход название топика и выводить кол-во сообщений в нём.

## Раздел Cassandra

Архитектура кластера Cassandra
* Seed nodes: mipt-node0[1-3].atp-fivt.org
* Остальные узлы: mipt-node0[4-8].atp-fivt.org

Входные данные лежат в локальной файловой системе: `/datasets/cassandra_practice_data/films`.
Структура данных:

|Название|Тип данных|
|---|---|
|tag|text|
|added_year|int|
|video_id|uuid|
|added_date|timestamp|
|description|text|
|title|text|
|user_id|uuid|

### Задания
№ задачи в задании 2 определяется по формуле: 
```bash
python2 -c 'import getpass; print(hash(getpass.getuser()) % 4 + 1)'
```
Используйте именно python2 т.к. в 3й версии при каждом вызове команды hash будет отличаться.
Для решения задач использовать Cassandra Python или Java API (см. [семинар](/practice/15-cassandra.md)).

### Задание 1 [1,7 балла]. 
Создать таблицу `videos_metadata_hob2020XX`, которая содержит метаинформацию о видеоуроках. При проектировании схемы БД старайтесь сделать ключи наиболее удобными для выполнения пункта 2. Загрузить в неё данные из датасета `/data/cassandra_practice_data/films`. При загрузке данных заменять video_id и user_id по таким правилам:
* `video_id`: n * [n-й знак числа PI], 
* `user_id`: n * [n-й знак числа e],

где `n` - порядковый номер строки.

Числа PI и e нужно расчитывать на лету. Не стоит хранить все необходимые знаки PI в памяти т.к. чем больше будет данных, тем больше знаков, а значит в какой-то момент память кончится.

### Задание 2 [1,1 балла]. 
Вариант 1. Написать программу, кот. делает выборку фильмов, которые выпущены в N году,  а user_id находится в интервале от A до B. 
Пример вызова программы:
```bash
./reader.py --year 2007 --start_id 0 --end_id 1000
```
Вариант 2. Написать программу, кот. делает выборку фильмов, которые имеют тег N,  а user_id находится в интервале от A до B. 
Пример вызова программы:
```bash
./reader.py --tag cassandra --start_id 0 --end_id 1000
```
Вариант 3. Написать программу, кот. делает выборку фильмов, которые имеют тег N,  причём этот тег встречается в названии (title). video_id находится в интервале от A до B. 
Пример вызова программы:
```bash
./reader.py --tag cassandra --start_id 0 --end_id 1000
```
Вариант 4. Написать программу, кот. делает выборку фильмов, которые имеют тег N,  причём этот тег встречается в описании (description). Год находится в интервале от A до B. 
Пример вызова программы:
```bash
./reader.py --tag cassandra --start_year 2001 --end_year 2005
```
